-- Schema: BCES
-- Complete schema with referenced tables for a normalized structure

-- Create EntityTypes Table
CREATE TABLE [BCES].[EntityTypes] (
    [EntityTypeID] INT IDENTITY(1,1) PRIMARY KEY,
    [EntityTypeName] NVARCHAR(50) NOT NULL
);

-- Create BusinessEntities Table
CREATE TABLE [BCES].[BusinessEntities] (
    [BusinessEntityID] INT IDENTITY(1,1) PRIMARY KEY,
    [EntityTypeID] INT FOREIGN KEY REFERENCES [BCES].[EntityTypes](EntityTypeID),
    [Code] NVARCHAR(20) NOT NULL,
    [Description] NVARCHAR(100) NULL
);

-- Create Suppliers Table
CREATE TABLE [BCES].[Suppliers] (
    [SupplierID] INT IDENTITY(1,1) PRIMARY KEY,
    [SupplierName] NVARCHAR(100) NOT NULL,
    [ContactName] NVARCHAR(100) NULL,
    [ContactEmail] NVARCHAR(100) NULL,
    [Phone] NVARCHAR(20) NULL,
    [Address] NVARCHAR(255) NULL
);
-- Create PartTypes Table
CREATE TABLE [BCES].[PartTypes] (
    [PartTypeID] INT IDENTITY(1,1) PRIMARY KEY,
    [PartTypeName] NVARCHAR(50) NOT NULL
);

-- Create CostCentres Table
CREATE TABLE [BCES].[CostCentres] (
    [CostCentreID] INT IDENTITY(1,1) PRIMARY KEY,
    [CostCentreName] NVARCHAR(100) NOT NULL,
    [Description] NVARCHAR(255) NULL
);

-- Create Parts Table (Unified Parts and RebuiltParts)
CREATE TABLE [BCES].[Parts] (
    [PartID] INT IDENTITY(1,1) PRIMARY KEY,
    [PartTypeID] INT FOREIGN KEY REFERENCES [BCES].[PartTypes](PartTypeID),
    [SupplierID] INT FOREIGN KEY REFERENCES [BCES].[Suppliers](SupplierID),
    [CostCentreID] INT FOREIGN KEY REFERENCES [BCES].[CostCentres](CostCentreID),
    [PartDescription] NVARCHAR(255) NULL,
    [Keyword] NVARCHAR(100) NULL,
    [Quantity] INT NOT NULL,
    [UnitCost] DECIMAL(10, 2) NULL,
    [CoreCost] DECIMAL(10, 2) NULL,
    [IsRebuilt] BIT NOT NULL DEFAULT 0,
    [RebuiltStockCode] NVARCHAR(50) NULL,
    [CoreCode] NVARCHAR(50) NULL,
    [SOPNumber] NVARCHAR(50) NULL,
    [JobNumber] NVARCHAR(50) NULL
);



-- Create VehicleTypes Table
CREATE TABLE [BCES].[VehicleTypes] (
    [VehicleTypeID] INT IDENTITY(1,1) PRIMARY KEY,
    [VehicleTypeName] NVARCHAR(50) NOT NULL
);

-- Create Vehicles Table
CREATE TABLE [BCES].[Vehicles] (
    [VehicleID] INT IDENTITY(1,1) PRIMARY KEY,
    [VehicleTypeID] INT FOREIGN KEY REFERENCES [BCES].[VehicleTypes](VehicleTypeID),
    [Make] NVARCHAR(25) NULL,
    [Model] NVARCHAR(25) NULL,
    [Year] NVARCHAR(4) NULL,
    [Engine] NVARCHAR(25) NULL,
    [Transmission] NVARCHAR(25) NULL,
    [Differential] NVARCHAR(25) NULL,
    [SOPNumber] NVARCHAR(30) NULL
);

-- Create VehicleParts Table
CREATE TABLE [BCES].[VehicleParts] (
    [VehicleID] INT FOREIGN KEY REFERENCES [BCES].[Vehicles](VehicleID),
    [PartID] INT FOREIGN KEY REFERENCES [BCES].[Parts](PartID),
    PRIMARY KEY ([VehicleID], [PartID])
);

-- Create LabourTasks Table
CREATE TABLE [BCES].[LabourTasks] (
    [LabourTaskID] INT IDENTITY(1,1) PRIMARY KEY,
    [PartID] INT FOREIGN KEY REFERENCES [BCES].[Parts](PartID),
    [TaskDescription] NVARCHAR(255) NOT NULL,
    [LabourPosition] NVARCHAR(100) NOT NULL,
    [CostCentreID] INT FOREIGN KEY REFERENCES [BCES].[CostCentres](CostCentreID),
    [PercentUsage] DECIMAL(5, 2) NOT NULL,
    [HoursRequired] DECIMAL(5, 2) NULL
);

-- Create LabourRates Table
CREATE TABLE [BCES].[LabourRates] (
    [LabourRateID] INT IDENTITY(1,1) PRIMARY KEY,
    [LabourTaskID] INT FOREIGN KEY REFERENCES [BCES].[LabourTasks](LabourTaskID),
    [CostCentreID] INT FOREIGN KEY REFERENCES [BCES].[CostCentres](CostCentreID),
    [RatePerHour] DECIMAL(10, 2) NOT NULL
);

-- Create EmployeeRoles Table
CREATE TABLE [BCES].[EmployeeRoles] (
    [RoleID] INT IDENTITY(1,1) PRIMARY KEY,
    [RoleName] NVARCHAR(50) NOT NULL
);

-- Create Employees Table
CREATE TABLE [BCES].[Employees] (
    [EmployeeID] INT IDENTITY(1,1) PRIMARY KEY,
    [EmployeeName] NVARCHAR(100) NOT NULL,
    [RoleID] INT FOREIGN KEY REFERENCES [BCES].[EmployeeRoles](RoleID)
);

-- Create EmployeeLabour Table
CREATE TABLE [BCES].[EmployeeLabour] (
    [EmployeeID] INT FOREIGN KEY REFERENCES [BCES].[Employees](EmployeeID),
    [LabourTaskID] INT FOREIGN KEY REFERENCES [BCES].[LabourTasks](LabourTaskID),
    PRIMARY KEY ([EmployeeID], [LabourTaskID])
);

-- Create SummaryTypes Table
CREATE TABLE [BCES].[SummaryTypes] (
    [SummaryTypeID] INT IDENTITY(1,1) PRIMARY KEY,
    [SummaryTypeName] NVARCHAR(50) NOT NULL
);

-- Create Summaries Table (Unified LabourSummary and MaterialSummary)
CREATE TABLE [BCES].[Summaries] (
    [SummaryID] INT IDENTITY(1,1) PRIMARY KEY,
    [SummaryTypeID] INT FOREIGN KEY REFERENCES [BCES].[SummaryTypes](SummaryTypeID),
    [LabourType] NVARCHAR(50) NULL,
    [CostCentreID] INT FOREIGN KEY REFERENCES [BCES].[CostCentres](CostCentreID),
    [Task] NVARCHAR(200) NULL,
    [Usage] NUMERIC(18, 2) NULL,
    [Time] NUMERIC(18, 2) NULL,
    [RatePerHour] NUMERIC(18, 2) NULL,
    [TotalCost] DECIMAL(18, 2) NULL,
    [ExtendedTime] NVARCHAR(8) NULL,
    [EstimateType] NVARCHAR(3) NULL,
    [EstimateNumber] NVARCHAR(25) NULL,
    [WrenchTime] NVARCHAR(25) NULL,
    [AssemblyArea] NVARCHAR(50) NULL,
    [TaxableCost] DECIMAL(18, 2) NULL,
    [RBReference] NVARCHAR(25) NULL,
    [TotalUnitCost] DECIMAL(18, 2) NULL
);


