function saveScPartPopup() {
    console.warn('Inside saveScPartPopup');
    var grid = $("#" + scInEstimateGridName).data("kendoGrid");
    var form = $("#scPartsForm");

    if (!form.valid()) {
        alert("Please fill all required fields.");
        return;
    }

    var formArray = form.serializeArray();
    var formDataObject = {};

    $.each(formArray, function (_, field) {
        if (!field.name.endsWith("_input")) {
            formDataObject[field.name] = field.value;
        }
    });

    ["UnitCost", "CoreCost", "Qty", "Percentage", "TotalCost"].forEach(function (key) {
        if (formDataObject[key] !== undefined && formDataObject[key] !== "") {
            formDataObject[key] = parseFloat(formDataObject[key]);
        }
    });

    //  Convert date to ISO 8601 for ASP.NET Core JSON binding
    if (formDataObject.LastModifiedDate) {
        formDataObject.LastModifiedDate = new Date(formDataObject.LastModifiedDate).toISOString();
    }

    console.warn('Cleaned formDataObject:', formDataObject);

    var isEdit = $("#MMSStockCode").val() !== "";

    $.ajax({
        url: isEdit
            ? '@Url.Action("UpdateScPartsUsedInEstimates", "ScPartsUsedInEstimates")?id=' + '@ViewBag.PartNum' + "&gridType=" + '@ViewBag.GridType'
            : '@Url.Action("CreateScPartsUsedInEstimates", "ScPartsUsedInEstimates")?id=' + '@ViewBag.PartNum' + "&gridType=" + '@ViewBag.GridType',
        type: "POST",
        contentType: "application/json; charset=UTF-8",
        data: JSON.stringify(formDataObject),
        success: function () {
            $(".k-window-content.k-content").data("kendoWindow").close();
            grid.dataSource.read();
        },
        error: function (xhr) {
            alert("Save failed: " + xhr.status + " " + xhr.responseText);
        }
    });
}
