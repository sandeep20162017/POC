-window.showDeleteConfirmation = function (e) {
    e.preventDefault();
    var grid = this; // Kendo Grid instance
    var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
    if (!dataItem) {
        console.error("No dataItem found for delete action");
        return;
    }

    var dlg = $("#deleteConfirmationDialog").data("kendoWindow");
    dlg.center().open();

    $("#confirmDeleteBtn").off("click").on("click", function () {
        $.ajax({
            type: "POST",
            url: "/RebuiltParts/DeleteRebuiltPart",
            data: { RebuiltId: dataItem.RebuiltId },
            success: function (response) {
                // ✅ Always close dialog once user confirms
                dlg.close();

                if (response.success) {
                    grid.dataSource.read();
                } else {
                    // Show alert if API returned success:false
                    kendo.alert("Unable to delete part.");
                }
            },
            error: function (xhr) {
                // ✅ Close dialog even when error occurs
                dlg.close();

                // Extract message from response (if provided by backend)
                var msg = xhr.responseText || "Unable to delete, part is used in archived estimates.";
                kendo.alert(msg);

                // Optionally refresh grid if needed (to reset any partial UI state)
                grid.dataSource.read();
            }
        });
    });

    $("#cancelDeleteBtn").off("click").on("click", function () {
        dlg.close();
    });
};
