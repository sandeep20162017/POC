<script>
    var currentVehicleId = 0;

    $(document).ready(function () {
        // Initialize and expand the Vehicle tab strip
        var tabStrip = $("#vehicleTabStrip").data("kendoTabStrip");
        tabStrip.select(0); // Select the first tab (Vehicles)

        $("#notification").kendoNotification();
        // Initialize popup
        $("#estimatePopup").kendoWindow({
            modal: true,
            width: "1100px",   // popup
            height: "570px",  // popup
            resizable: false,
            scrolllable: false,
            title: "Estimate",
            visible: false,
            actions: ["Close"],
            close: function (e) {
                if (pendingChanges) {
                    e.preventDefault();
                    showCloseConfirmation();
                }
            }
        });

        // Initialize TabStrip
        $("#estimateTabs").kendoTabStrip({

            animation: { open: { effects: "fadeIn" } },
            select: onTabSelect,
            activate: function (e) {
                // Load first tab immediately
                if ($(e.item).index() === 0 && $("#vehicleTabContent").is(":empty")) {
                    loadTabContent(
                        "vehicleTabContent",
                        '@Url.Action("GetVehicleById", "Vehicles")',
                        { id: currentVehicleId }
                    );
                }
            }
        });

        // Disable all tabs except Vehicle initially
        disableOtherTabs();

        var vehicleGrid = $("#VehicleGrid").data("kendoGrid");

        if (vehicleGrid) {
            vehicleGrid.dataSource.bind("requestEnd", function (e) {
                if (e.type === "create" && e.response && !e.response.Errors) {
                    enableAllTabs();
                }
            });
        }

        //make stock code column clickable for edit
        $(document).on("click", ".stock-code-cell", function () {
            var grid = $("#" + scInEstimateGridName).data("kendoGrid");
            if (grid) {
                var row = $(this).closest("tr");
                grid.editRow(row); // open popup editor
            }
        });
        //make non stock code column clickable for edit
        $(document).on("click", ".non-stock-code-cell", function () {
            var grid = $("#" + nscInEstimateGridName).data("kendoGrid");
            if (grid) {
                var row = $(this).closest("tr");
                grid.editRow(row); // open popup editor
            }
        });
        //make rb column clickable for edit
        $(document).on("click", ".rb-code-cell", function () {
            var grid = $("#" + rbInEstimateGridName).data("kendoGrid");
            if (grid) {
                var row = $(this).closest("tr");
                grid.editRow(row); // open popup editor
            }
        });
        //make Labour column clickable for edit
        $(document).on("click", ".labour-cell", function () {
            var grid = $("#" + labourInEstimateGridName).data("kendoGrid");
            if (grid) {
                var row = $(this).closest("tr");
                grid.editRow(row); // open popup editor
            }
        });
    });


    function disableOtherTabs() {
        var ts = $("#estimateTabs").data("kendoTabStrip");
        for (var i = 1; i <= 7; i++) {
            ts.enable(ts.tabGroup.children().eq(i), false);
        }
    }

    function enableAllTabs() {
        var ts = $("#estimateTabs").data("kendoTabStrip");
        for (var i = 1; i <= 7; i++) {
            ts.enable(ts.tabGroup.children().eq(i), true);
        }
    }


</script>
