var currentColumnName = "";
var currentComboBox = null;

$(document).ready(function () {
    setTimeout(function () {
        var grid = $("#NscPartsUsedGrid").data("kendoGrid");

        if (grid) {
            console.error('found grid');
            grid.bind("edit", function (e) {
                console.error('inside edit');
                // Capture the column name being edited
                var fieldName = e.container.find("input[data-role='combobox']").attr("name");
                currentColumnName = fieldName || "";
                console.error("Current Column:", currentColumnName);

                // ✅ Get ComboBox directly from the container
                currentComboBox = e.container.find("input[data-role='combobox']").data("kendoComboBox");

                if (currentComboBox) {
                    console.log("ComboBox initialized in cell:", currentComboBox);
                } else {
                    console.warn("ComboBox not found in cell!");
                }
            });
        } else {
            console.error('Grid not found');
        }
    }, 100);
});

// ✅ Updated getComboBoxParams to reference active ComboBox
function getComboBoxParams() {
    console.log("inside getComboBoxParams", currentColumnName);

    if (currentComboBox) {
        console.log("inside if combobox", currentColumnName);
        var params = {
            columnName: currentColumnName,
            searchText: currentComboBox.text() || "" // Get value directly from active combobox
        };

        console.log("Sending params:", params);
        return params;
    }

    console.warn("No active ComboBox found!");
    return {};
}
