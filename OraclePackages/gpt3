INSERT INTO ARCH_RB_MASTERLIST ( MMS_STOCK_CODE, ITEM_REF_NUMBER, DETAILED_DESC, KEYWORD, CORE_PART_NUM, REBUILT_STOCK_NUM, CORE_CHARGE, JOB_NUMBER, ESTIMATED_COST, SOP_NUMBER, DATE_ARCHIVED, ARCHIVED_BY, ARCH_RB_MASTERLIST_ID, LABOUR_COST, LABOUR_OVERHEAD_AMOUNT, LABOUR_TOTAL, MATERIALS_TOTAL, TOTAL_REBUILT_PART_COST, TAX_TOTAL, TOTAL_COST_TAX ) SELECT MMS_STOCK_CODE, ITEM_REF_NUMBER, DETAILED_DESC, KEYWORD, CORE_PART_NUM, REBUILT_STOCK_NUM, CORE_CHARGE, JOB_NUMBER, ESTIMATED_COST, SOP_NUMBER, SYSDATE, :B9 , ARCH_RB_MASTERLIST_SEQ.NEXTVAL, :B8 , :B7 , :B6 , :B5 , :B4 , :B3 , :B2 FROM RB_MASTERLIST WHERE UPPER(REBUILT_STOCK_NUM) = :B1 
INSERT INTO ARCH_RB_MATERIALS_CC_TOTAL (COST_CENTRE, TOTAL_COST, ARCH_RB_MASTERLIST_ID ) SELECT COST_CENTRE AS "CC", SUM(TOTAL_COST) AS "TOTAL COST", :B1 FROM TEMP_MATERIALS_LIST GROUP BY COST_CENTRE
INSERT INTO ARCH_RB_LABOUR_CC_TOTAL ( COST_CENTRE, TOTAL_HOURS, ARCH_RB_MASTERLIST_ID ) SELECT CC AS "COST CENTRE", SUM(EXTENDED_TIME) AS "LABOUR HRS", :B1 FROM TEMP_LABOUR_LIST GROUP BY CC
INSERT INTO ARCH_RB_SC_PARTS_USED ( MMS_STOCK_CODE, DATE_ENTERED, REB_PART_COST, USER_ENTERED, MMS_COST, OEM_COST, MMS_REBUILT_CODE, COST_CENTRE, QTY_REQD, PERCENT_USAGE, LINK_CODE, REBUILT_PART, LINK_TYPE, CORECOST, ARCH_RB_MASTERLIST_ID, TOTAL_COST, SC_KEYWORD, SC_DESCRIPTION) SELECT A.MMS_STOCK_CODE, A.DATE_ENTERED, A.REB_PART_COST, A.USER_ENTERED, A.MMS_COST, A.OEM_COST, A.MMS_REBUILT_CODE, A.COST_CENTRE, A.QTY_REQD, A.PERCENT_USAGE, A.LINK_CODE, A.REBUILT_PART, A.LINK_TYPE, CAST(FINAL_COST(A.PERCENT_USAGE, A.QTY_REQD, A.CORECOST, 0)AS NUMBER) AS CORECOST, ARCH_RB_MASTERLIST_SEQ.CURRVAL, A.MMS_COST * CAST(A.QTY_REQD AS NUMBER) * (TO_NUMBER(REPLACE(NVL(A.PERCENT_USAGE,'0'),',','.'))/ 100), NVL(B.PART_TYPE,'') , NVL(B.DETAILED_DESC,'') FROM SC_PARTS_USED A, STOCK_CODED_PARTS B WHERE B.MMS_STOCK_CODE (+)= A.MMS_STOCK_CODE AND LINK_CODE = :B2 AND LINK_TYPE = :B1 AND REBUILT_PART = 'N'
INSERT INTO ARCH_RB_EMPLOYEE_LABOUR ( LABOUR_DEFN, DATE_ENTERED, LINK_NUMBER, TYPEID, COSTCENTRE, ARCH_RB_EMPLOYEE_LABOUR.TASK, LABOUR_TYPE, USAGE, HRS_REQD, ADJ_HRS, TIME_ADDITION, ARCH_RB_MASTERLIST_ID ) SELECT LABOUR_DEFN, DATE_ENTERED, LINK_NUMBER, TYPEID, COSTCENTRE, EMPLOYEE_LABOUR.TASK, LABOUR_TYPE, USAGE, HRS_REQD, ADJ_HRS, TIME_ADDITION, ARCH_RB_MASTERLIST_SEQ.CURRVAL FROM EMPLOYEE_LABOUR WHERE LINK_NUMBER = :B2 AND TYPEID = :B1 
INSERT INTO ARCH_RB_LIST_BUSES ( BUS_DESCRIPTION, ARCH_RB_MASTERLIST_ID ) SELECT LIST_OF_BUSES.DESCRIPTION, :B2 FROM RB_LIST_OF_BUSES, LIST_OF_BUSES WHERE REBUILT_STOCK_NUM = :B1 AND RB_LIST_OF_BUSES.LIST_ID = LIST_OF_BUSES.LIST_ID
INSERT INTO ARCH_RB_NSC_PARTS_USED (ORIG_SUPP_NUM, ORIG_SUPPLIER_NAME, COST_CENTRE, QTY_REQD, PERCENT_USAGE, DATE_ENTERED, ENTERED_BY, LINK_CODE, COST, LINK_TYPE, CORECOST, ARCH_RB_MASTERLIST_ID, TOTAL_COST) SELECT ORIG_SUPP_NUM, ORIG_SUPPLIER_NAME, COST_CENTRE, QTY_REQD, PERCENT_USAGE, DATE_ENTERED, ENTERED_BY, LINK_CODE, COST, LINK_TYPE, CAST(FINAL_COST(PERCENT_USAGE, QTY_REQD, CORECOST, 0) AS NUMBER) AS CORECOST, :B3 , COST * CAST(QTY_REQD AS NUMBER) * (TO_NUMBER(REPLACE(NVL(PERCENT_USAGE,'0'),',','.'))/ 100) FROM NSC_PARTS_USED WHERE LINK_CODE = :B2 AND LINK_TYPE = :B1 
INSERT INTO ARCH_RB_SC_PARTS_USED ( MMS_STOCK_CODE, DATE_ENTERED, REB_PART_COST, USER_ENTERED, MMS_COST, OEM_COST, MMS_REBUILT_CODE, COST_CENTRE, QTY_REQD, PERCENT_USAGE, LINK_CODE, REBUILT_PART, LINK_TYPE, CORECOST, ARCH_RB_MASTERLIST_ID, TOTAL_COST, SC_KEYWORD, SC_DESCRIPTION) SELECT UPPER(SC_PARTS_USED.MMS_STOCK_CODE), SC_PARTS_USED.DATE_ENTERED, NVL(A.RB_UNIT_COST,0) AS "UNIT COST", UPPER(SC_PARTS_USED.USER_ENTERED), NVL(SC_PARTS_USED.MMS_COST,0), NVL(SC_PARTS_USED.OEM_COST,0), UPPER(SC_PARTS_USED.MMS_REBUILT_CODE) AS "REBUILT NUMBER", UPPER(SC_PARTS_USED.COST_CENTRE) AS "CC", UPPER(SC_PARTS_USED.QTY_REQD) AS "QTY", REPLACE(SC_PARTS_USED.PERCENT_USAGE,',','.') AS "%", :B2 , 'Y', 'RB', SC_PARTS_USED.CORECOST AS "CORE COST", :B3 , NVL(A.RB_COST,0) AS "TOTAL COST", UPPER(RB_MASTERLIST.KEYWORD) AS "KEYWORD", UPPER(RB_MASTERLIST.DETAILED_DESC) AS "DESCRIPTION" FROM SC_PARTS_USED, RB_MASTERLIST, (SELECT ROUND(SUM(TOTAL_COST),2) AS RB_COST, ROUND(SUM(TOTAL_UNIT_COST),2) AS RB_UNIT_COST , RB_REFERENCE FROM TEMP_MATERIALS_LIST GROUP BY RB_REFERENCE) A WHERE SC_PARTS_USED.LINK_CODE = :B2 AND SC_PARTS_USED.REBUILT_PART = 'Y' AND SC_PARTS_USED.LINK_TYPE = :B1 AND RB_MASTERLIST.REBUILT_STOCK_NUM(+)= SC_PARTS_USED.MMS_REBUILT_CODE AND RB_REFERENCE (+)= SC_PARTS_USED.MMS_REBUILT_CODE
begin :V00001 := CES_ARCHIVE.ARCHIVE_RB(:V00002,:V00003,:V00004,:V00005,:V00006,:V00007,:V00008,:V00009,:V00010,:V00011,:V00012,:V00013); end;
SELECT MAX(ARCH_RB_MASTERLIST_ID) FROM ARCH_RB_MASTERLIST
begin CES_INQUIRY.RB_LIST_BUSES(VI_REBUILT_STOCK_NUM=>:V00001, VO_CURSOR=>:R000C000); end;
SELECT RB_LIST_OF_BUSES.LIST_ID, LIST_OF_BUSES.DESCRIPTION FROM RB_LIST_OF_BUSES, LIST_OF_BUSES WHERE RB_LIST_OF_BUSES.REBUILT_STOCK_NUM = :B1 AND RB_LIST_OF_BUSES.LIST_ID = LIST_OF_BUSES.LIST_ID
INSERT INTO TEMP_LABOUR_LIST VALUES (:B8 ,:B7 ,:B6 ,:B2 ,HHMM_TO_MINUTES(:B4 ),:B5 , :B5 * HHMM_TO_MINUTES(:B4 ) * :B2 / 6000, ROUND((:B2 / 100) * HHMM_TO_MINUTES(:B4 )) ,'RB',UPPER(:B3 ), ROUND((:B2 / 100) * HHMM_TO_MINUTES(:B1 )))
begin CES_INQUIRY.RETRIEVE_RB(VO_CURSOR=>:R000C000); end;
SELECT UPPER(REBUILT_STOCK_NUM) AS "rebuilt_stock_num", MMS_STOCK_CODE, KEYWORD, DETAILED_DESC, NVL(SOP_NUMBER,' ') AS "sop_number", NVL(JOB_NUMBER,' ') AS "job_number", CORE_PART_NUM, CORE_CHARGE, ESTIMATED_COST, DATE_MODIFIED, ACTIVE, ROWID FROM RB_MASTERLIST
begin :V00001 := CES_UPDATE.AUDIT_INSERT_MODIFY_HISTORY(:V00002,:V00003,:V00004,:V00005,:V00006,:V00007,:V00008,:V00009,:V00010,:V00011,:V00012,:V00013,:V00014,:V00015,:V00016,:V00017,:V00018,:V00019,:V00020,:V00021,:V00022,:V00023,:V00024,:V00025,:V00026,:V00027,:V00028,:V00029,:V00030,:V00031,:V00032,:V00033,:V00034,:V00035,:V00036,:V00037,:V00038,:V00039,:V00040,:V00041,:V00042,:V00043,:V00044); end;
SELECT UPPER(SC_PARTS_USED.LINK_CODE) AS "link_code", UPPER(SC_PARTS_USED.LINK_TYPE) AS "link_type" FROM SC_PARTS_USED WHERE SC_PARTS_USED.REBUILT_PART = 'Y' AND SC_PARTS_USED.MMS_REBUILT_CODE = :B1 
begin CES_INQUIRY.RETRIEVE_EST_TO_PROPAGATE_RB(VI_IDNUM=>:V00001, VO_CURSOR=>:R000C000); end;
INSERT INTO AUDIT_MODIFY_HISTORY ( ID, USER_NAME, DATE_CHANGED, ACTION, ESTIMATE_NUMBER, ESTIMATE_TYPE, REF_1, REF_2, REF_3, REF_4, REF_5, REF_6, REF_7, REF_8, REF_9, REF_10, REF_11, REF_12, REF_13, REF_14, REF_15, REF_16, REF_17, REF_18, REF_19, REF_20, REF_21, REF_22, REF_23, REF_24, REF_25, REF_26, REF_27, REF_28, REF_29, REF_30, REF_31, REF_32, REF_33, REF_34, REF_35, REF_36, REF_37, REF_38 ) VALUES ( :B43 , :B42 , SYSDATE, :B41 , :B40 , :B39 , :B38 , :B37 , :B36 , :B35 , :B34 , :B33 , :B32 , :B31 , :B30 , :B29 , :B28 , :B27 , :B26 , :B25 , :B24 , :B23 , :B22 , :B21 , :B20 , :B19 , :B18 , :B17 , :B16 , :B15 , :B14 , :B13 , :B12 , :B11 , :B10 , :B9 , :B8 , :B7 , :B6 , :B5 , :B4 , :B3 , :B2 , :B1 )
begin :V00001 := CES_UPDATE.AUDIT_INSERT_MODIFY_HISTORY(:V00002,:V00003,:V00004,:V00005,:V00006,:V00007,:V00008,:V00009,:V00010,:V00011,:V00012,:V00013,:V00014,:V00015,:V00016,:V00017,:V00018,:V00019,:V00020,:V00021,:V00022,:V00023,:V00024,:V00025,:V00026,:V00027,:V00028,:V00029,:V00030,:V00031,:V00032,:V00033,:V00034,:V00035,:V00036,:V00037,:V00038,:V00039,:V00040,:V00041,:V00042,:V00043,:V00044); end;
begin :V00001 := CES_UPDATE.UPDATE_LABOUR_TASKS(:V00002,:V00003,:V00004,:V00005,:V00006,:V00007,:V00008,:V00009,:V00010,:V00011,:V00012,:V00013,:V00014); end;
UPDATE EMPLOYEE_LABOUR SET LABOUR_DEFN = UPPER(NVL(:B12 , ' ')), LINK_NUMBER = UPPER(NVL(:B11 , ' ')), TYPEID = UPPER(NVL(:B10 , ' ')), COSTCENTRE = UPPER(NVL(:B9 , ' ')), EMPLOYEE_LABOUR.TASK = UPPER(NVL(:B8 , ' ')), LABOUR_TYPE = UPPER(NVL(:B7 , ' ')), USAGE = UPPER(NVL(:B6 , ' ')), HRS_REQD = NVL(:B5 , 0), ADJ_HRS = NVL(:B4 , 0), DATE_REVISED = SYSDATE, TIME_ADDITION = :B3 , LAST_MODIFIED_BY = :B2 WHERE ROWID = :B1 
begin CES_INQUIRY.RETRIEVE_TASK_DESCRIPTION(VO_CURSOR=>:R000C000); end;
begin CES_INQUIRY.RETRIEVE_MB_ALL_LABOUR(VO_CURSOR=>:R000C000, VI_ROWID=>:V00001); end;
begin CES_INQUIRY.RETRIEVE_LABOUR_POSITION(VO_CURSOR=>:R000C000); end;
SELECT TASK_ID, UPPER(TASK_DESCRIPTION) AS "TASK DESCRIPTION" FROM LABOUR_TASK_DESCRIPTIONS ORDER BY TASK_DESCRIPTION ASC
SELECT UPPER(LABOUR_DEFN) AS LABOUR_DEFN FROM EMPL_CLASS ORDER BY LABOUR_DEFN
SELECT UPPER(HRS_REQD) AS HRS_REQD, UPPER(USAGE) AS USAGE, UPPER(TASK) AS TASK, UPPER(COSTCENTRE) AS COSTCENTRE, UPPER(LABOUR_DEFN) AS LABOUR_DEFN, ROWID FROM EMPLOYEE_LABOUR WHERE ROWID = :B1 ORDER BY COSTCENTRE
SELECT * FROM ARCH_RB_MASTERLIST WHERE REBUILT_STOCK_NUM = :B1
