SELECT 
    EL.LabourDefn AS LabourType,
    EL.CostCentre AS CC,
    EL.Task,
    REPLACE(EL.Usage, ',', '.') AS Usage,
    EL.HrsReqd AS Time,
    ES.RatePerHour,
    ES.RatePerHour *
	(CASE 
                -- Handle decimal values (e.g., "2.00", "4.00")
                WHEN CHARINDEX(':', EL.HrsReqd) = 0 THEN 
                    TRY_CAST(EL.HrsReqd AS DECIMAL(10, 2)) * 60 -- Convert hours to minutes

                -- Handle HH:MM format (e.g., "10:35")
                ELSE 
                    TRY_CAST(LEFT(EL.HrsReqd, CHARINDEX(':', EL.HrsReqd) - 1) AS INT) * 60 + -- Hours to minutes
                    TRY_CAST(SUBSTRING(EL.HrsReqd, CHARINDEX(':', EL.HrsReqd) + 1, LEN(EL.HrsReqd)) AS INT) -- Add minutes
            END) *
	--* CAST(SBCES.DecimalMinutesToHhmm(EL.HrsReqd) AS DECIMAL(10, 2)) * 
	CAST(REPLACE(EL.Usage, ',', '.') AS DECIMAL(10, 2)) / 100 AS TotalCost,
    --SBCES.DecimalMinutesToHhmm(EL.AdjHrs) AS ExtendedTime,
	--------
	(CASE 
                -- Handle decimal values (e.g., "2.00", "4.00")
                WHEN CHARINDEX(':', EL.AdjHrs) = 0 THEN 
                    TRY_CAST(HrsReqd AS DECIMAL(10, 2)) * 60 -- Convert hours to minutes

                -- Handle HH:MM format (e.g., "10:35")
                ELSE 
                    TRY_CAST(LEFT(EL.AdjHrs, CHARINDEX(':', EL.AdjHrs) - 1) AS INT) * 60 + -- Hours to minutes
                    TRY_CAST(SUBSTRING(EL.AdjHrs, CHARINDEX(':', EL.AdjHrs) + 1, LEN(EL.AdjHrs)) AS INT) -- Add minutes
            END) AS ExtendedTime,
	-----
    EL.TypeId AS EstimateType,
    EL.LinkNumber AS EstimateNumber,
    EL.AdjHrs AS WrenchTime
FROM 
    SBCES.EmployeeLabour EL
    JOIN SBCES.EmplClass EC ON EL.LabourDefn = UPPER(EC.LabourDefn)
    JOIN SBCES.EmployeeSalaries ES ON EC.WageGroup = ES.WageGroup
