PRINT 'Fetching Labour Hour Summary...';
SELECT 
    CostCentre,
    -- Sum of HrsReqd (converted to DECIMAL(10, 2)) and then to HH:MM format
    SBCES.DecimalMinutesToHhmm(
        SUM(
            CAST(
                CASE 
                    WHEN RIGHT(HrsReqd, 1) = ':' THEN LEFT(HrsReqd, LEN(HrsReqd) - 1) -- Remove trailing colon
                    ELSE HrsReqd -- No colon, keep as is
                END AS DECIMAL(10, 2)
            ) * 60 -- Convert hours to minutes for summing
        )
    ) AS TotalHrsReqdInHhmm
FROM 
    SBCES.EmployeeLabour
WHERE 
    LinkNumber = @LinkCode
    AND TypeId = @LinkType
GROUP BY 
    CostCentre;
