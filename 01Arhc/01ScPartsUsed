INSERT INTO [SBCES].[ArchVehScPartsUsed] (
    [MmsStockCode],
    [DateEntered],
    [RebPartCost],
    [UserEntered],
    [MmsCost],
    [OemCost],
    [MmsRebuiltCode],
    [CostCentre],
    [QtyReqd],
    [PercentUsage],
    [LinkCode],
    [RebuiltPart],
    [LinkType],
    [Corecost],
    [ArchVehicleListId],
    [TotalCost],
    [ScKeyword],
    [ScDescription]
)
SELECT
    spu.[MmsStockCode],
    spu.[DateEntered],
    spu.[RebPartCost],
    spu.[EnteredBy] AS [UserEntered],  -- Source: EnteredBy → Target: UserEntered
    spu.[MmsCost],
    spu.[OemCost],
    spu.[MmsRebuiltCode],
    spu.[CostCentre],
    spu.[QtyReqd],
    spu.[PercentUsage],
    spu.[LinkCode],
    spu.[RebuiltPart],
    spu.[LinkType],
    spu.[CoreCost],  -- Source: CoreCost → Target: Corecost (case-insensitive)
    avl.[ArchVehicleListId],  -- Critical link from archive table
    NULL AS [TotalCost],  -- Not in source schema
    NULL AS [ScKeyword],   -- Not in source schema
    NULL AS [ScDescription] -- Not in source schema
FROM [SBCES].[ScPartsUsed] spu
INNER JOIN [SBCES].[ArchVehicleList] avl 
    ON avl.[OldId] = TRY_CAST(LTRIM(RTRIM(spu.[LinkCode])) AS INT)
WHERE
    TRY_CAST(LTRIM(RTRIM(spu.[LinkCode])) AS INT) IS NOT NULL;
