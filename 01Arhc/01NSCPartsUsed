INSERT INTO [SBCES].[ArchVehNscPartsUsed] (
    [OrigSuppNum],
    [OrigSupplierName],
    [CostCentre],
    [QtyReqd],
    [PercentUsage],
    [DateEntered],
    [EnteredBy],
    [LinkCode],
    [Cost],
    [LinkType],
    [Corecost],
    [ArchVehicleListId],
    [TotalCost]
)
SELECT
    np.[OrigSuppNum],
    np.[OrigSupplierName],
    np.[CostCentre],
    np.[QtyReqd],
    np.[PercentUsage],
    np.[DateEntered],
    np.[EnteredBy],
    np.[LinkCode],
    np.[Cost],
    np.[LinkType],
    np.[CoreCost],  -- Source is CoreCost, target is Corecost (case-insensitive)
    avl.[ArchVehicleListId],  -- Critical link from archive table
    NULL AS [TotalCost]  -- Not in source schema; set as NULL
FROM [SBCES].[NscPartsUsed] np
INNER JOIN [SBCES].[ArchVehicleList] avl 
    ON avl.[OldId] = TRY_CAST(LTRIM(RTRIM(np.[LinkCode])) AS INT)
WHERE
    TRY_CAST(LTRIM(RTRIM(np.[LinkCode])) AS INT) IS NOT NULL;
