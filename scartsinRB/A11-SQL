SELECT 
    UPPER(SBCES.NONSTOCKCODEDPARTS.ORIGSUPPLIERNUM) AS [SUPPLIER NUMBER],
    UPPER(SBCES.NONSTOCKCODEDPARTS.ORIGSUPPLIERNAME) AS [SUPPLIER NAME],
    SBCES.NONSTOCKCODEDPARTS.OEMPARTCOST AS [UNIT COST],
    UPPER(SBCES.NSCPARTSUSED.QTYREQD) AS [QTY],
    REPLACE(SBCES.NSCPARTSUSED.PERCENTUSAGE, ',', '.') AS [%],
    -- Casting logic with SBCES.FINALCOST
    CAST(SBCES.FINALCOST(
        CAST(SBCES.NSCPARTSUSED.PERCENTUSAGE AS NUMERIC(18,2)), 
        CAST(SBCES.NSCPARTSUSED.QTYREQD AS NUMERIC(18,2)), 
        SBCES.NSCPARTSUSED.CORECOST, 
        0
    ) AS DECIMAL(18,2)) AS [CORE COST],
    CAST(SBCES.FINALCOST(
        CAST(SBCES.NSCPARTSUSED.PERCENTUSAGE AS NUMERIC(18,2)), 
        CAST(SBCES.NSCPARTSUSED.QTYREQD AS NUMERIC(18,2)), 
        SBCES.NONSTOCKCODEDPARTS.OEMPARTCOST, 
        0
    ) AS DECIMAL(18,2)) AS [TOTAL COST],
    UPPER(SBCES.NSCPARTSUSED.COSTCENTRE) AS [CC],
    ISNULL(UPPER(SBCES.NONSTOCKCODEDPARTS.DETAILEDDESC), '') AS [DESCRIPTION],
    ISNULL(UPPER(SBCES.NONSTOCKCODEDPARTS.KEYWORD), '') AS [KEYWORD],
    UPPER(SBCES.NSCPARTSUSED.ID) AS [ID],
    UPPER(SBCES.NSCPARTSUSED.LASTMODIFIEDDATE) AS [LAST MODIFIED DATE],
    SBCES.NSCPARTSUSED.ROWID
FROM 
    SBCES.NSCPARTSUSED  -- Schema applied
LEFT JOIN 
    SBCES.NONSTOCKCODEDPARTS  -- Schema applied
    ON SBCES.NONSTOCKCODEDPARTS.ID = SBCES.NSCPARTSUSED.ID
WHERE 
    SBCES.NSCPARTSUSED.LINKCODE = @RebuiltPartNum
    AND SBCES.NSCPARTSUSED.LINKTYPE = 'RB'
ORDER BY 
    SBCES.NONSTOCKCODEDPARTS.ORIGSUPPLIERNUM;
