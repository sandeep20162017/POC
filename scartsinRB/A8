DECLARE @RebuiltPartNum VARCHAR(30) = '035434';

SELECT 
    UPPER(SCP.MMSSTOCKCODE) AS MMSSTOCKCODE,
    ISNULL(SCP.MMSCOST, 0) AS UnitCost,
    UPPER(SCP.QTYREQD) AS QTY,
    REPLACE(SCP.PERCENTUSAGE, ',', '.') AS [Percentage],
    REPLACE(
        CAST(SBCES.FINALCOST(
            CAST(SCP.PERCENTUSAGE AS NUMERIC(18,2)), 
            CAST(SCP.QTYREQD AS NUMERIC(18,2)), 
            SCP.CORECOST, 
            0
        ) AS DECIMAL(18,2)), ',', '.'
    ) AS CORECOST,
    REPLACE(
        CAST(SBCES.FINALCOST(
            CAST(SCP.PERCENTUSAGE AS NUMERIC(18,2)), 
            CAST(SCP.QTYREQD AS NUMERIC(18,2)), 
            SCP.MMSCOST, 
            0
        ) AS DECIMAL(18,2)), ',', '.'
    ) AS TOTALCOST,
    UPPER(SCP.COSTCENTRE) AS CC,
    ISNULL(UPPER(SCPARTS.DETAILEDDESC), '') AS DESCRIPTION,
    ISNULL(UPPER(SCPARTS.PARTTYPE), '') AS KEYWORD,
    SCP.OEMCOST AS [OEM COST],
    SCP.MMSREBUILTCODE AS MMSREBUILTCODE,
    SCP.REBPARTCOST AS [REBUILT PART COST],
    UPPER(SCP.REBUILTPART) AS REBUILTPART,
    SCP.ROWID
FROM 
    SBCES.SCPARTSUSED SCP
LEFT JOIN 
    SBCES.STOCKCODEDPARTS SCPARTS 
    ON SCPARTS.MMSSTOCKCODE = SCP.MMSSTOCKCODE
WHERE 
    SCP.LINKCODE = @RebuiltPartNum 
    AND SCP.LINKTYPE = 'RB'
ORDER BY 
    SCP.MMSSTOCKCODE;
