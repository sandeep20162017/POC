
Updated JavaScript (fixed variable scope + matching your controller actions)
javascript
Copy
Edit
var currentVehicleId = 0;

$(document).ready(function () {
    // Initialize popup
    $("#estimatePopup").kendoWindow({
        modal: true,
        width: 1150,
        height: 600,
        title: "Estimate",
        visible: false,
        actions: ["Close"]
    });

    // Initialize TabStrip
    $("#estimateTabs").kendoTabStrip({
        animation: { open: { effects: "fadeIn" } },
        select: onTabSelect
    });

    // Disable all tabs except Vehicle initially
    disableOtherTabs();
});

function openEstimatePopup(vehicleId) {
    var win = $("#estimatePopup").data("kendoWindow");
    currentVehicleId = vehicleId;

    win.title(vehicleId === 0 ? "Add New Estimate" : "Vehicle Estimate #" + vehicleId);
    win.center().open();

    // Load vehicle tab first
    loadTabContent("vehicleTabContent", "/Vehicles/VehPopUp", { id: vehicleId }, function () {
        if (vehicleId !== 0) {
            enableAllTabs();
        }
    });
}

function onTabSelect(e) {
    var index = $(e.item).index();

    // Match your actual actions here
    var tabsConfig = [
        { id: "vehicleTabContent", url: "/Vehicles/VehPopUp" },
        { id: "partsTabContent", url: "/Vehicles/MaterialCostSummaryPartial" },   // Parts
        { id: "labourTabContent", url: "/Vehicles/LabourDetailsPartial" },        // Labour
        { id: "stockCodedPartsTabContent", url: "/Vehicles/ScDetailsPartial" },   // Stock coded
        { id: "nonStockCodedPartsTabContent", url: "/Vehicles/NonStockPartsPartial" }, // Non stock coded
        { id: "rebuiltPartsTabContent", url: "/Vehicles/LabourHourSummaryPartial" },   // Rebuilt
        { id: "finalEstimateTabContent", url: "/Estimates/FinalEstimate" }        // Final estimate
    ];

    var tab = tabsConfig[index];

    // Safety check — skip if no mapping
    if (!tab) return;

    // Load only if empty
    if ($("#" + tab.id).is(":empty")) {
        loadTabContent(tab.id, tab.url, { id: currentVehicleId, gridType: "VehicleGrid" });
    }
}

function loadTabContent(tabId, url, data, callback) {
    $("#" + tabId).load(url, data, function () {
        if (typeof callback === "function") {
            callback();
        }
    });
}

function disableOtherTabs() {
    var ts = $("#estimateTabs").data("kendoTabStrip");
    for (var i = 1; i <= 6; i++) {
        ts.enable(ts.tabGroup.children().eq(i), false);
    }
}

function enableAllTabs() {
    var ts = $("#estimateTabs").data("kendoTabStrip");
    for (var i = 1; i <= 6; i++) {
        ts.enable(ts.tabGroup.children().eq(i), true);
    }
}
What Changed
targetId bug fixed → Now loadTabContent explicitly takes tabId as a parameter, so no undefined variable issues.

Updated URLs → Matches exactly your controller actions like:

/Vehicles/MaterialCostSummaryPartial

/Vehicles/LabourDetailsPartial

/Vehicles/ScDetailsPartial

/Vehicles/NonStockPartsPartial

/Vehicles/LabourHourSummaryPartial

Extra params → Added gridType: "VehicleGrid" to match your controller’s gridType parameter expectations.
