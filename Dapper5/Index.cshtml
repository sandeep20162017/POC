@using BCES.Models.Admin
@model IEnumerable<UserViewModel>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>User Management</h2>

@(Html.Kendo().Grid<UserViewModel>()
    .Name("userGrid")
    .Columns(columns =>
    {
        columns.Bound(u => u.UserId).Hidden(); // Hide the UserId column
        columns.Bound(u => u.UserName).Title("User Name").Width(200);
        columns.Bound(u => u.RoleModel.RoleName)
               .Title("Role")
               .EditorTemplateName("RoleNameDropDown")
               .Width(150);
        
        columns.Command(command =>
        {
            command.Custom("Save").Click("onSave").Text("Save");
            command.Custom("Delete").Click("onDelete").Text("Delete");
        }).Title("Actions").Width(200);
    })
    .ToolBar(toolbar =>
    {
        toolbar.Custom().Text("Add New User").HtmlAttributes(new { id = "addNewUser" });
    })
    .Editable(editable => editable.Mode(GridEditMode.InCell))
    .DataSource(dataSource => dataSource
        .Ajax()
        .Read(read => read.Action("GetUsers", "UserManagement")) // Ensure this is properly set
        .Update(update => update.Action("UpdateUser", "UserManagement"))
        .Create(create => create.Action("AddUser", "UserManagement"))
        .Destroy(delete => delete.Action("DeleteUser", "UserManagement"))
        .Model(model =>
        {
            model.Id(u => u.UserId); // Set primary key for grid rows
            model.Field(u => u.RoleModel.RoleName).DefaultValue("Select Role");
        })
    )
)
<script>
    $(document).ready(function () {
        $("#addNewUser").click(function () {
            var grid = $("#userGrid").data("kendoGrid");
            grid.addRow();
        });
    });

    function onSave(e) {
        e.preventDefault();
        var grid = $("#userGrid").data("kendoGrid");
        grid.saveRow();
    }

    function onDelete(e) {
        e.preventDefault();
        var grid = $("#userGrid").data("kendoGrid");
        grid.removeRow($(e.currentTarget).closest("tr"));
    }
</script>
